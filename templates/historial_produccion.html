{% extends "base.html" %}
{% block titulo %}Historial ProducciÃ³n{% endblock %}

{% block contenido %}
<h2 class="text-secondary mb-3">ðŸ•“ Historial de producciÃ³n</h2>

<form method="GET" class="card p-3 shadow-sm mb-3">
  <div class="row g-2">
    <div class="col-md-4">
      <label class="form-label">Producto</label>
      <select name="producto_id" class="form-select">
        <option value="">Todos</option>
        {% for p in productos %}
          <option value="{{ p.id }}" {% if sel_producto_id == p.id %}selected{% endif %}>{{ p.nombre }} - {{ p.acabado }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">Tipo</label>
      <select name="tipo" class="form-select">
        <option value="" {% if sel_tipo=='' %}selected{% endif %}>Todos</option>
        <option {% if sel_tipo=='Entrada' %}selected{% endif %}>Entrada</option>
        <option {% if sel_tipo=='Salida' %}selected{% endif %}>Salida</option>
      </select>
    </div>
    <div class="col-md-2">
      <label class="form-label">Desde</label>
      <input type="date" name="desde" value="{{ sel_desde }}" class="form-control">
    </div>
    <div class="col-md-2">
      <label class="form-label">Hasta</label>
      <input type="date" name="hasta" value="{{ sel_hasta }}" class="form-control">
    </div>
    <div class="col-md-2 d-flex align-items-end gap-2">
      <button class="btn btn-primary w-100">Filtrar</button>
      <a href="/historial-produccion" class="btn btn-outline-secondary w-100">Limpiar</a>
    </div>
  </div>
</form>

<table class="table table-striped table-bordered shadow-sm">
  <thead class="table-dark">
    <tr>
      <th>Fecha</th>
      <th>Producto</th>
      <th>Acabado</th>
      <th>Tipo</th>
      <th>Cantidad</th>
      <th>Bodega</th>
    </tr>
  </thead>
  <tbody>
    {% for m, p in movs %}
    <tr>
      <td>{{ m.fecha.strftime("%Y-%m-%d %H:%M") }}</td>
      <td>{{ p.nombre }}</td>
      <td>{{ p.acabado }}</td>
      <td>{{ m.tipo }}</td>
      <td>{{ m.cantidad }}</td>
      <td>{{ p.bodega }}</td>
    </tr>
    {% else %}
    <tr><td colspan="6" class="text-center text-muted">No hay movimientos con esos filtros</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
