{% extends "base.html" %}
{% block titulo %}Movimientos de producción{% endblock %}

{% block contenido %}
<h1 class="mb-4 text-primary">Registrar movimiento de producción</h1>

<form method="POST" class="card p-3 shadow-sm">
  <!-- Producto -->
  <div class="mb-3">
    <label class="form-label">Producto</label>
    <select name="producto" class="form-select" required>
      {% for prod in productos %}
      <option value="{{ prod.id }}" {{ sel_prod==prod.id and 'selected' or '' }}>
        {{ prod.nombre }} - {{ prod.acabado }} ({{ '%.1f'|format(prod.cantidad_actual) }}) — {{ prod.bodega }}
      </option>
      {% endfor %}
    </select>
  </div>

  <!-- Tipo -->
  <div class="mb-3">
    <label class="form-label">Tipo de movimiento</label>
    <select name="tipo" id="tipo" class="form-select" required>
      <option value="Entrada">Entrada</option>
      <option value="Salida">Salida</option>
      <option value="Transferencia">Transferencia</option>
    </select>
  </div>

  <!-- Bodega destino (sólo para Transferencia) -->
  <div class="mb-3" id="row-destino" style="display:none;">
    <label class="form-label">Bodega destino</label>
    <select name="bodega_destino" class="form-select">
      <option value="">Selecciona destino…</option>
      {% for b in bodegas %}
      <option value="{{ b }}">{{ b }}</option>
      {% endfor %}
    </select>
    <div class="form-text">Moverá el producto a la bodega elegida (no cambia la cantidad).</div>
  </div>

  <!-- Cantidad (ocultar en Transferencia) -->
  <div class="mb-3" id="row-cantidad">
    <label class="form-label">Cantidad</label>
    <input type="number" step="0.01" min="0" name="cantidad" class="form-control">
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary">Guardar movimiento</button>
    <a href="{{ url_for('produccion') }}" class="btn btn-outline-secondary">Volver</a>
  </div>
</form>

<script>
  const tipo = document.getElementById('tipo');
  const rowDestino = document.getElementById('row-destino');
  const rowCantidad = document.getElementById('row-cantidad');

  function toggleRows() {
    if (tipo.value === 'Transferencia') {
      rowDestino.style.display = '';
      rowCantidad.style.display = 'none';
    } else {
      rowDestino.style.display = 'none';
      rowCantidad.style.display = '';
    }
  }
  tipo.addEventListener('change', toggleRows);
  toggleRows(); // inicial
</script>
{% endblock %}

