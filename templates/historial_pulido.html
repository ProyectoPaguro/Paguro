{% extends "base.html" %}
{% block titulo %}Historial de Pulido{% endblock %}

{% block contenido %}
<div class="container mt-4">

  <h2 class="text-center text-primary mb-4">üìú Historial de Pulido</h2>

  <!-- üîπ Filtros -->
  <form method="GET" class="row g-3 mb-4">

    <!-- Tipo de filtro -->
    <div class="col-md-3">
      <label class="form-label">Ver historial</label>
      <select name="filtro" class="form-select" onchange="this.form.submit()">
        <option value="general" {% if filtro == 'general' %}selected{% endif %}>General</option>
        <option value="dia" {% if filtro == 'dia' %}selected{% endif %}>Por d√≠a</option>
        <option value="semana" {% if filtro == 'semana' %}selected{% endif %}>Por semana</option>
        <option value="mes" {% if filtro == 'mes' %}selected{% endif %}>Por mes</option>
      </select>
    </div>

    {% if filtro == 'dia' %}
    <div class="col-md-3">
      <label class="form-label">Fecha</label>
      <input type="date" name="fecha" class="form-control" value="{{ fecha }}" onchange="this.form.submit()">
    </div>
    {% endif %}

    {% if filtro == 'semana' %}
    <div class="col-md-3">
      <label class="form-label">A√±o</label>
      <input type="number" name="year" class="form-control" value="{{ year }}" min="2024" max="2100" onchange="this.form.submit()">
    </div>

    <div class="col-md-3">
      <label class="form-label">Semana</label>
      <input type="number" name="week" class="form-control" min="1" max="53" value="{{ week }}" onchange="this.form.submit()">
    </div>
    {% endif %}

    {% if filtro == 'mes' %}
    <div class="col-md-3">
      <label class="form-label">A√±o</label>
      <input type="number" name="year" class="form-control" value="{{ year }}" min="2024" max="2100" onchange="this.form.submit()">
    </div>

    <div class="col-md-3">
      <label class="form-label">Mes</label>
      <select name="month" class="form-select" onchange="this.form.submit()">
        {% for m in range(1,13) %}
        <option value="{{ m }}" {% if month == m %}selected{% endif %}>{{ m }}</option>
        {% endfor %}
      </select>
    </div>
    {% endif %}
  </form>

  <!-- üîπ Tabla -->
  {% if registros %}
  <table class="table table-striped table-hover shadow-sm">
    <thead class="table-dark">
      <tr>
        <th>Fecha</th>
        <th>Empleado</th>
        <th>Producto</th>
        <th>Acabado</th>
        <th>Cantidad</th>
        <th>Categor√≠a</th>
        <th>Observaciones</th>
      </tr>
    </thead>

    <tbody>
      {% for r in registros %}
      <tr>
        <td>{{ r.fecha }}</td>
        <td>{{ r.usuario.nombre }}</td>
        <td>{{ r.producto }}</td>
        <td>{{ r.acabado or '-' }}</td>
        <td><strong>{{ r.cantidad }}</strong></td>
        <td>
          {% if r.categoria_id %}
            {{ r.categoria_produccion.nombre if r.categoria_produccion else 'Sin categor√≠a' }}
          {% else %}
            <span class="text-muted">Sin categor√≠a</span>
          {% endif %}
        </td>
        <td>{{ r.observaciones or '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>

  </table>
  {% else %}
  <div class="alert alert-info text-center">
    No hay registros para este filtro.
  </div>
  {% endif %}

</div>
{% endblock %}
